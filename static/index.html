<head>
  <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
</head>

<body>
  <div id='deliveryStatus'></div>
  <div id='countByStatus'></div>
  <div id='topBusiestDomains'></div>
  <div id='topBouncedDomains'></div>
  <div id='topDeferredDomains'></div>

  <script type="application/javascript">
    fetch("/deliveryStatus").then(res => res.json()).then(function(data) {
      var data = [{
        values: data.map(v => v["Value"]),
        labels: data.map(v => v["Status"]),
        type: 'pie'
      }];

      var layout = {
        title: "Delivery Status",
        height: 400,
        width: 500
      };

      Plotly.newPlot('deliveryStatus', data, layout);
    })

    const fillBarChart = function(graphName, title) {
      fetch("/" + graphName).then(res => res.json()).then(function(data) {
        if (data == null) {
          return
        }

        var data = [{
          x: data.map(v => v["Domain"]),
          y: data.map(v => v["Count"]),
          type: 'bar'
        }];

        var layout = {
          title: title,
          height: 400,
          width: 500
        };

        Plotly.newPlot(graphName, data, layout);
      })
    }

    fillBarChart("topBusiestDomains", "Busiest Domains")
    fillBarChart("topDeferredDomains", "Most Deferred Domains")
    fillBarChart("topBouncedDomains", "Most Bounced Domains")

  </script>

</body>
